<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
    	<title>Timeseries</title>
    	<script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
	    <link rel='stylesheet' href='http://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.min.css' />
	    <script src='http://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js'></script>

	    <link rel='stylesheet' href='http://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.1/leaflet.css' />
	    <script src='http://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.1/leaflet.js'></script>

	    <script src='http://cdn.rawgit.com/turban/Leaflet.Sync/0.0.5/L.Map.Sync.js'></script>

		<link rel= "stylesheet" type = "text/css"
		    href = "{{ url_for('static', filename = 'style.css') }}">

		<link rel= "stylesheet" type = "text/css"
		    href = "{{ url_for('static', filename = 'bootstrap.min.css') }}">    
	</head>

	<body>
   	<div class="container-fluid">
	    <h2>Timeseries</h2>
	    <p>mapnum={{mapnum}}, dset={{dset}}, variable={{variable}}, bds={{bds}}</p>

	    <div id='img{{ mapnum }}' class='key'><img /></div>

	    <div id="button_csv" class='btn btn-default'>Download data</div>
	    

		<!-- <a href="/timeseries/{{mapnum}}&monthly_navy_winds&UWND[z=0, l=1]&BDS=30.234375,-110.390625,70.3125,-70.3125&DOWNLOADTS=yes)">Click me.</a> -->
		<a href="/download_ts">Click me.</a>
	  	
	    <script>
	   
		    $('#img{{mapnum}}').children('img').attr('src', 'http://localhost:8000/showts_resource?MAPNUM={{mapnum}}' +
		    								'&DSET={{dset}}&VARIABLE={{variable}}&BDS={{bds}}' +															
											'&DOWNLOADTS=no'
											 );

		 //    //Define timeseries download button and pass paramteters to route
			$("#button_csv").click(function(){
			 	// $(this).attr("src", 'http://localhost:8000/showts_resource?DSET={{dset}}&REQUEST=CalcTimeseries&DOWNLOADTS=yes')	
				
			 	$.ajax({
		            url: 'http://localhost:8000/showts_resource?MAPNUM={{mapnum}}' +
		    								'&DSET={{dset}}&VARIABLE={{variable}}&BDS={{bds}}' +															
											'&DOWNLOADTS=yes',
		            // data: $('form').serialize(),
		            type: 'GET',
		            success: function(response) {
		                console.log(response);
		            },
		            error: function(error) {
		                console.log(error);
		            }
		        });

				// return false;
			});

			
		</script>


  	</div> <!-- ./container --> 
  </body>
</html>