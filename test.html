<!doctype html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Project Alpha</title>

    <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
    <link rel='stylesheet' href='http://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.min.css' />
    <script src='http://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js'></script>

    <link rel='stylesheet' href='http://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.2/leaflet.css' />
    <script src='http://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.2/leaflet.js'></script>

    <script src='http://cdn.rawgit.com/turban/Leaflet.Sync/master/L.Map.Sync.js'></script>

    <link rel="stylesheet" href="http://cdn.pydata.org/bokeh/release/bokeh-0.12.3.min.css" type="text/css" />
    <script type="text/javascript" src="http://cdn.pydata.org/bokeh/release/bokeh-0.12.3.min.js"></script>

    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-loading-bar.min.css" type="text/css" />
    <script src="http://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>

    <style type='text/css'>
        html, body {
                font-family: 'arial';
                font-size: 12px;
        }
        .mapContainer { display: inline-block; margin-left: 10px; margin-top: 10px; }
        .map { width: 520px; height: 260px; }
	.ui-dialog { z-index: 1000; }
    </style>


</head>

<div class='mapContainer'>
   <div id='map1' class='map'></div>
</div>

<br>
<button id="timeSeries">Time series</button>

<script type='text/javascript'>

//===============================================
var crs = L.CRS.EPSG4326;

var map = [];
var frontiers = [];

//===============================================
frontiers[1] = L.tileLayer.wms('http://www.globalcarbonatlas.org/geoserver/GCA/wms', {
        layers: 'GCA:GCA_frontiersCountryAndRegions',
        format: 'image/png',
        crs: crs,
        transparent: true
});

map[1] = L.map('map1', {
    layers: [frontiers[1]],
    crs: crs,
    center: [0,-40],
    zoom: 1,
    attributionControl: false
});

//===============================================
n=1;
$('#timeSeries').on('click', function() {
    console.log("here");

    xlim1 = map[1].getBounds().getEast().toFixed(2);
    xlim2 = map[1].getBounds().getWest().toFixed(2);
    ylim1 = Math.max(-90, map[1].getBounds().getSouth().toFixed(2));
    ylim2 = Math.min(map[1].getBounds().getNorth().toFixed(2), 90);
    console.log(xlim1,xlim2);
    console.log(ylim1,ylim2);

   $.ajax({
       url: "timeSeries_03.py",
       data: {	"VAR": "THETAO",
		"XLIM": xlim1 + ":" + xlim2, 
             	"YLIM": ylim1 + ":" + ylim2},
       type: "GET",
       cache: false,
       dataType: 'html',
       success: function(data) {
               console.log("success");
               console.log(data);

    		$('body').append("<div id='ts"+n+"'>" + data + "</div>");

                   $('#ts'+n).dialog({
                        title: "Time Series #" + n + "   (X=" + xlim1 + ":" + xlim2 + "@ave, Y=" + ylim1 + ":" + ylim2 + "@ave)",
                        width: 640
                   });
    		n++;
       		},
       error: function() {
               console.log("error");
       },
   });

});

</script>

</body>
</html>

